:sourcesdir: ../../../../../source

[[file_upload]]
===== Загрузка файлов

Для загрузки файлов с компьютера пользователя в хранилище следует использовать компоненты <<gui_FileUploadField,FileUpload>> и <<gui_FileMultiUploadField,FileMultiUpload>>. Примеры использования приведены в описании компонентов.

[TIP]
====
Руководство https://www.cuba-platform.com/guides/working-with-images[Working with Images in CUBA applications] содержит примеры, демонстрирующие, как загружать изображения.
====

Компонент `FileUpload` также можно использовать в готовом диалоговом окне `FileUploadDialog`, позволяющем загружать файлы в промежуточное хранилище.

Диалоговое окно `FileUploadDialog` предоставляет базовую функциональность загрузки файлов в промежуточное хранилище. Оно содержит drop zone для перетаскивания файлов извне браузера и кнопку загрузки файла.

image::gui_fileUploadDialog.png[align="center"]

Данный диалог можно использовать следующим образом:

[source, java]
----
include::{sourcesdir}/features/fileUploadDialog_1.java[]
----
<1> - получение объекта `java.io.File`, указывающего на файл в файловой системе блока Web Client. Это может потребоваться, если вам нужно как-то обработать файл, а не просто поместить его в <<file_storage,хранилище>>.
<2> - создание сущности `FileDescriptor`.
<3> - загрузка файла в хранилище среднего слоя.
<4> - сохранение сущности `FileDescriptor`.

В случае успешной загрузки диалог закрывается с `COMMIT_ACTION_ID`, поэтому используйте `CloseWithCommitListener` для получения результата загрузки. Чтобы получить UUID и имя загруженного файла, используйте методы `getFileId()` и `getFileName()`. Затем можно получить сам файл, а также, например, создать `FileDescriptor` и загрузить файл в хранилище, или реализовать какую-либо другую логику.

Промежуточное хранилище клиентского уровня `FileUploadingAPI` использует для хранения временных файлов каталог, заданный свойством приложения <<cuba.tempDir,cuba.tempDir>>. Временные файлы удаляются автоматически в следующих случаях:

* Для `FileUploadField` задан <<gui_FileUploadField_fileStoragePutMode,режим>> `IMMEDIATE`.
* Используется метод `FileUploadingAPI.putFileIntoStorage(UUID, FileDescriptor)`.

В остальных случаях рекомендуется удалить файл, используя метод `FileUploadingAPI.deleteFile(UUID)`.

Временные файлы могут оставаться в промежуточном хранилище в случае сбоев. Для удаления таких файлов служит метод `clearTempDirectory()` бина `cuba_FileUploading`. Этот метод периодически (в полночь вторника, четверга и субботы) вызывается шедулером, объявленным в файле <<spring.xml,cuba-web-spring.xml>>, и удаляет файлы старше 2-х дней.

